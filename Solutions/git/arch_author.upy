# Generate an architecture from the last author to touch the file.
# Make sure to also install git_util.py
import und_lib.git_util as git_util

def name():
  return "Git Author"

def description():
  return '''Group files by Git author.
    <p>By default, this plugin uses the most recent author, showing the last
    author to modify a file. It can also be configured to show the creator
    (first author).</p>

    <p>Example: the "Top 5" chart of this architecture for the CMake project.
    </p><br>
    <img src=".doc/arch_author.png">

    <p>See also the "Git Owner" architecture which groups by the author
    with the most commits. </p>
  '''

def tags():
  return [
    'Solution: Git'
  ]

def is_enabled_by_default():
  return True

def define_options(arch):
  arch.options().radio_horiz("author", "Author", ["Creator", "Most Recent"], "Most Recent")

def build(arch, db):
  idx = 0
  if arch.options().lookup("author") == "Creator":
    idx = -1

  authors = git_util.gitAuthors(arch,db)
  for file, authorList in authors.items():
    if authorList:
      arch.map(file, authorList[idx])

