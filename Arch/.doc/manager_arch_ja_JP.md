# 概要

自動アーキテクチャ・プラグインは、Understand プロジェクトを開くたびに実行される Python スクリプトです。これにより、自動的に更新される独自のアーキテクチャを簡単に作成できます。あらゆる用途に使用することができます。

![image](../../.doc/home_arch.png)

*[Copyright and License](und://plugin/arch/Copyright%20and%20License) アーキテクチャから生成された依存関係グラフ*

いくつかのアイデアをご紹介します:
 - バージョン管理をクエリして、最も頻繁に変更されたファイルのアーキテクチャを作成し、[変更頻度（コードチャーン）を特定](und://plugin/arch/Git%20Stability)します。
 - フォルダ構造やファイル名に基づいて、ファイルを自動的に分割します。
 - サードパーティのライブラリとチームのコードを素早く分離するアーキテクチャを作成します。

たとえば、[Git Author](und://plugin/arch/Git%20Author) は Git にクエリして各ファイルを最後に編集した人物を特定し、その情報からアーキテクチャを作成します。そのアーキテクチャを使って、閲覧中のファイルのオーナーを確認したり、作成者ベースで依存関係を探索したり、さらには誰のコードが最も複雑かを確認したりできます。

![image](archs.png)


## アーキテクチャの実行

アーキテクチャ・プラグインは、何度でも利用できるインターフェースのようなものです。たとえば、[Git Date](und://plugin/arch/Git%20Date) プラグインで新しい自動アーキテクチャを2回作成し、1回は最終更新日用、もう1回は作成日用にできます。プラグインマネージャーの「実行」ボタンから、アーキテクチャ・プラグインを直接作成できます。

![image](../../.doc/run_arch.png)

あるいは、「アーキテクチャ」 -> 「新規自動アーキテクチャ」 から有効化したプラグインにアクセスできます。

![image](new_arch.png)

「アーキテクチャ」 -> 「アーキテクチャ ブラウザー」を選択して作成したアーキテクチャを確認することができます。

## 独自のプラグインを作成する

[Long Name](und://plugin/arch/Long%20Name) 自動アーキテクチャ・プラグインは、[Understand Python API Documentation &#8599;](https://docs.scitools.com/manuals/python/arch.html) に示されているサンプルテンプレートです。スクリプト作成に関する [チュートリアル &#8599;](https://understand.techmatrix.jp/understand-70-pythonapi-tutorial-1/) もあります。アーキテクチャはバックグラウンドで生成されますが、すべてのアーキテクチャが完了するまで、アーキテクチャを使用する一部の機能が利用できない場合がある点にご留意ください。

### カスタムプラグイン作成時のヒント

1. プラグインファイルに変更を加えた場合は、その都度、プラグインの管理の左下にある「更新」ボタンを使ってプラグインスクリプトのキャッシュを更新する必要があります。

![image](../../.doc/refresh.png)

2. 「カスタマイズ」を使って新しいプラグインを作成する際は、既存のアーキテクチャ・プラグインと衝突しないよう、新しい別の名前を付ける必要があります。カスタマイズしたプラグインは、スクリプトを更新するまでプラグインの管理に表示されません。また、Understand の GUI からアクセスできるようにするには有効化する必要があります。さらに、プラグインに文法エラーがある場合はプラグインの管理に表示されません。
3. 別の場所からプラグインをインストールするには、プラグインの管理の左下の「プラグインの追加」ボタンを使用するか、ファイルを Understand にドラッグ＆ドロップします。

![image](../../.doc/add_plugin.png)

4. Understand は、Python 3.12 で導入された [per-interpreter GIL feature &#8599;](https://peps.python.org/pep-0684/) を利用して、複数のスレッドがそれぞれ自分専用の Python インタプリタに同時にアクセスできるようにしています。per-interpreter GIL の構成は [single-phase initialization  &#8599;](https://docs.python.org/3/c-api/module.html#single-phase-initialization) を使用するモジュールとは互換性がありません。つまり、プラグインではマルチフェーズ初期化をサポートするネイティブモジュールのみをインポートする必要があります。
